<html>
	<head>

		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link href="/style.css" rel="stylesheet">

	</head>
	<body>
		<div class="chat-box">
			<div class="container-fluid box-shadow-bottom upper-bar-options">
				<div class="row">
					<ul class="settings-collection">
						<li class="settings-square-icon inline-block">A</li>
						<li class="settings-square-icon inline-block">B</li>
						<li class="settings-square-icon inline-block">C</li>
					</ul>
				</div>
			</div>
			<div class="container-fluid box-shadow-bottom">
				<div class="row row-chat-overview">
					<div class="col-md-9 position-relative">
						<div class="chat-overview">
							<div id="chat">

							</div>
						</div>
						<form id="send-message">
							<div class="new-message-overview position-relative">
								<div class="icons-toolbar">ABC</div>
								<textarea id="message"></textarea>
								<div class="submit-button-chat-wrapper">
									<input class="submit-button-chat" type="submit">
								</div>
							</div>
						</form>
					</div>
					<div class="col-md-3 position-relative">
						<p>Enter a username:</p>
						<p id="nickError"></p>
						<form id="setNick">
							<input id="nickname"></input>
							<input type="submit"></input>
						</form>

						<div id="users"></div>

					</div>
				</div>
			</div>
		</div>

			<audio style="display:none;" id="notification-player-audio" >
			  <source id="notification-player" src="http://mart.server2.teamcreative.nl/assets/MSNNotification.mp3" type="audio/mpeg">
			</audio>
			<script src="http://code.jquery.com/jquery-latest.min.js"></script>
			<script src="/socket.io/socket.io.js"></script>

			<script>

				var socket = io.connect();

				$(function() {
					var $nickForm = $("#setNick");
					var $nickError = $("#nickError");
					var $nickBox = $("#nickname");
					var $users = $("#users");
					var $messageForm = $("#send-message");
					var $messageBox = $("#message");
					var $chat = $("#chat");

					$nickForm.submit(function(e){
						e.preventDefault();
						socket.emit('new user', $nickBox.val(), function(data){
							if(data) {
								$('#nickWrap').hide();
								$('#contentWrap').show();
							} else {
								$nickError.html('That username is already taken. Try again...');
							}
						});
						$nickBox.val('');
					});

					socket.on('usernames', function(data){
						var html = '';
						for(i = 0; i < data.length; i++) {
							html += '<button onclick="openNewConnection(\'' + data[i] + '\')" class="userListName" data-attr="' + data[i] + '">' + data[i] + '</div><br>';
						}
						$users.html(html);
					});

					$messageForm.submit(function(e){
						e.preventDefault();
						socket.emit('send message', $messageBox.val());
						$messageBox.val('');
					});

					socket.on('new message', function(data){
						$chat.append("<div class='message-user'><p class='message-name'>" + data.nick + " says:</p><p>" + data.msg + "</p></div>");

						var wtf    = $('#chat');
						var height = wtf[0].scrollHeight;
						wtf.scrollTop(height);

						$('.notification-player-audio').trigger("play");
					});

					socket.on('whisper', function(data) {
						$chat.append("<div class='message-user'><p class='message-name'>" + data.nick + " says:</p><p>" + data.msg + "</p></div>");
					});

					socket.on('open connection', function(data) {
						window.open("chatbox.html",null,"height=500,width=800,status=yes,toolbar=no,menubar=no,location=no");
					});

				});

				function openNewConnection(data) {
					var nameToChat = data;
					socket.emit('open connection', nameToChat);
				}
			</script>

	</body>
</html>
